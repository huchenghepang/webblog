import{bz as I,l as K,r as f,o as Q,f as w,g as i,p as l,af as o,d as k,F as U,u as C,aV as p,G as D,bA as W,aF as X,H as x,bB as Y,ag as Z,bc as ee,v as le,bd as te,h as se,ba as oe,bb as ne,bC as ae,_ as ie}from"./index-CKb1g0gP.js";import{E as re}from"./el-tree-CiQijIh1.js";import"./el-checkbox-BY2y9xrT.js";import{E as ue}from"./el-popover-CYDQSfoj.js";import{c as de,a as me,b as E,V as pe}from"./index.esm-DueM3VUK.js";import{p as z}from"./permissionValidate-DlOLNRd5.js";const ce=async()=>await I({url:"/permission/getpermissions"}),ve=async(v,u)=>await I({url:`/permission/update/${v}`,data:u,method:"put"}),fe=async v=>await I({url:`/permission/delete/${v}`,method:"delete"}),_e=async v=>await I({url:"/permission/addpermission",method:"post",data:v}),be=de({permissionName:E().required("权限名称是必填项").min(1,"权限名称的最小长度为 1").max(100,"权限名称的最大长度为 100"),description:E().max(255,"描述的最大长度为 255").notRequired(),permissionValue:E().max(40,"描述的最大长度为 40").notRequired(),type:E().required("类型是必填项").oneOf(["route","button"],"类型必须是 'route' 或 'button'"),parentId:me().integer("父级 ID 必须是整数").min(0,"父级 ID 必须是非负整数").notRequired()}),F=async v=>{try{return await be.validate(v,{abortEarly:!1}),{valid:!0,errors:[]}}catch(u){if(u instanceof pe)return{valid:!1,errors:u.errors};throw u}},ye={class:"PermissionView-container"},Ve={class:"custom-tree-container"},ge={class:"custom-tree-node"},we={class:"right-container"},ke=["onClick"],Ce=["onClick"],xe={class:"right-container"},Ee=["onClick"],Ie=["onClick"],he={class:"dialog-footer"},Ne=K({__name:"PermissionView",setup(v){const u=f(!1),n=f({permissionName:"",description:"",type:"",parentId:null,permissionValue:""});function A(){n.value={permissionName:"",description:"",type:"",parentId:null}}const b=f({}),B=(r,e)=>{u.value=!0,b.value=e};function S(){u.value=!1}async function R(){if(!z("permission.add"))return!1;try{const{valid:r,errors:e}=await F(n.value);if(!r){p({message:e[0],type:"error"});return}const{code:a}=await _e(n.value);a==200?(p({message:"添加权限成功",type:"success"}),u.value=!1,g(),A()):p({message:"添加权限失败",type:"error"})}catch{p({message:"添加权限失败",type:"error"})}}const H=async(r,e)=>{if(!z("permission.delete"))return!1;try{const{code:a}=await fe(e.permission_id);a==200?(p({message:"删除成功",type:"success"}),g()):p({message:"删除失败",type:"error"})}catch{p({message:"删除失败",type:"error"})}},h=f(null);function $(r,e){if(!z("permission.edit"))return!1;y.value=!y.value,h.value=r.id,d.value={permissionName:e.permission_name,description:e.description,type:e.type,parentId:e.parent_id,permissionValue:e.permission_value}}const q=f([]);async function g(){try{const{data:r}=await ce();q.value=r}catch(r){console.log(r)}}const M=f(!1);function O(){M.value=!0}const d=f({permissionName:"string",description:"string",type:"button",parentId:"string"}),y=f(!0);async function T(r,e){try{const{valid:a,errors:N}=await F(d.value);if(!a){p({message:N[0],type:"error"});return}const c=d.value;console.log(c),console.log(e.permission_id);const{code:_}=await ve(e.permission_id,c);_==200?(p({message:"更新权限成功",type:"success"}),y.value=!y.value,g()):p({message:"更新权限失败",type:"error"})}catch{p({message:"更新权限失败",type:"error"})}}return Q(()=>{g()}),(r,e)=>{const a=X,N=ue,c=Z,_=te,P=ee,G=re,V=ne,L=oe,j=ae;return k(),w("div",ye,[i("div",Ve,[l(G,{style:{"max-width":"100%"},data:q.value,"show-checkbox":"","node-key":"permission_id","default-expand-all":"","expand-on-click-node":!1},{default:o(({node:t,data:m})=>[i("span",ge,[y.value||h.value!==t.id?(k(),w(U,{key:0},[i("span",null,C(m.permission_name),1),i("span",null,C(m.permission_value),1),i("span",null,C(m.description),1),i("span",null,C(m.type),1),i("span",we,[i("a",{class:"append-btn btn button",onClick:s=>B(t,m)}," 添加 ",8,ke),i("a",{class:"edit-btn btn button",onClick:s=>$(t,m)}," 编辑 ",8,Ce),l(N,{width:"220",icon:D(W),"icon-color":"#626AEF",title:"你确定要删除这个吗",onConfirm:s=>H(t,m),onCancel:O},{reference:o(()=>[l(a,{disabled:!m.can_delete,class:"delete-btn btn",size:"small",type:"danger",icon:D(Y)},null,8,["disabled","icon"])]),actions:o(({confirm:s,cancel:J})=>[l(a,{size:"small",onClick:J},{default:o(()=>e[10]||(e[10]=[x("不!")])),_:2},1032,["onClick"]),l(a,{type:"danger",size:"small",disabled:!m.can_delete,onClick:s},{default:o(()=>e[11]||(e[11]=[x(" 是? ")])),_:2},1032,["disabled","onClick"])]),_:2},1032,["icon","onConfirm"])])],64)):!y.value&&h.value===t.id?(k(),w(U,{key:1},[l(c,{modelValue:d.value.permissionName,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value.permissionName=s),style:{width:"300px"},size:"small"},null,8,["modelValue"]),l(c,{modelValue:d.value.permissionValue,"onUpdate:modelValue":e[1]||(e[1]=s=>d.value.permissionValue=s),style:{width:"100px"},size:"small"},null,8,["modelValue"]),l(c,{modelValue:d.value.description,"onUpdate:modelValue":e[2]||(e[2]=s=>d.value.description=s),style:{width:"300px"},size:"small"},null,8,["modelValue"]),l(P,{modelValue:d.value.type,"onUpdate:modelValue":e[3]||(e[3]=s=>d.value.type=s),placeholder:"Select",size:"small",style:{width:"100px",height:"100%"}},{default:o(()=>[(k(),w(U,null,le(["button","route"],s=>l(_,{key:s,label:s,value:s},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),i("span",xe,[i("a",{class:"edit-btn btn button",onClick:s=>$(t,m)}," 取消 ",8,Ee),i("a",{class:"append-btn btn button",onClick:s=>T(t,m)}," 确定 ",8,Ie)])],64)):se("",!0)])]),_:1},8,["data"])]),l(j,{modelValue:u.value,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value=t),title:"添加权限",width:"500","lock-scroll":!1},{footer:o(()=>[i("div",he,[l(a,{onClick:S},{default:o(()=>e[12]||(e[12]=[x("取消")])),_:1}),l(a,{type:"primary",onClick:R},{default:o(()=>e[13]||(e[13]=[x(" 确定 ")])),_:1})])]),default:o(()=>[l(L,{model:n.value,"label-width":"auto",style:{"max-width":"600px"}},{default:o(()=>[l(V,{label:"权限名称"},{default:o(()=>[l(c,{modelValue:n.value.permissionName,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.permissionName=t)},null,8,["modelValue"])]),_:1}),l(V,{label:"权限值"},{default:o(()=>[l(c,{modelValue:n.value.permissionValue,"onUpdate:modelValue":e[5]||(e[5]=t=>n.value.permissionValue=t)},null,8,["modelValue"])]),_:1}),l(V,{label:"描述"},{default:o(()=>[l(c,{modelValue:n.value.description,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.description=t)},null,8,["modelValue"])]),_:1}),l(V,{label:"权限类型"},{default:o(()=>[l(P,{modelValue:n.value.type,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.type=t),placeholder:"选择",size:"small"},{default:o(()=>[l(_,{disabled:b.value.type=="button",label:"route",value:"route"},null,8,["disabled"]),l(_,{label:"button",value:"button"})]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"父级权限ID"},{default:o(()=>[l(P,{modelValue:n.value.parentId,"onUpdate:modelValue":e[8]||(e[8]=t=>n.value.parentId=t),placeholder:"选择",size:"small"},{default:o(()=>[l(_,{label:"同级添加",value:b.value.parent_id?b.value.parent_id:0},null,8,["value"]),l(_,{label:"下级添加",disabled:b.value.type=="button",value:b.value.permission_id},null,8,["disabled","value"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Fe=ie(Ne,[["__scopeId","data-v-2f8099d6"]]);export{Fe as default};
