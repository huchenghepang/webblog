import{l as G,r as _,a as L,ci as J,o as K,cj as O,aV as d,d as h,f as D,g as b,p as o,af as l,H as u,aF as Q,ck as W,F as X,v as Z,u as ee,al as te,bE as oe,G as v,cl as ne,bC as ae,_ as se}from"./index-CKb1g0gP.js";import{E as le}from"./el-pagination-BLRT_Ruj.js";import{E as re,a as ie}from"./el-table-column-BtqCWYaW.js";import{a as pe,b as de}from"./el-checkbox-BY2y9xrT.js";import{E as me}from"./el-popover-CYDQSfoj.js";import{b as ue,c as ce}from"./comment-C04qkBVq.js";import{v as I}from"./validate-CdMOi96S.js";import{p as M}from"./permissionValidate-DlOLNRd5.js";import{h as z}from"./moment-C5S46NFB.js";import"./index.esm-DueM3VUK.js";const fe={class:"ManageComment-container"},ge={class:"header-container"},ve={class:"filter-container"},Ce={class:"dialog-footer"},_e=G({__name:"ManageComment",setup(be){const x=_([]),m=_([]),T=({row:t,rowIndex:e})=>t.status==="pending"?"warning-row":t.status==="approved"?"success-row":"",V=(t,e)=>t.status==="pending"?"待审核":t.status==="approved"?"审核通过":t.status==="rejected"?"审核不通过":t.status,Y=(t,e,s)=>{const p=s.property;return e[p]===t},i=L({page:1,limit:50,limits:[5,10,15,20,50,100],total:0}),$=t=>{i.limit=t,f()},j=t=>{i.page=t,f()},H=t=>{m.value=t.map(e=>e.commentId)};function N(t){m.value=[t],E()}async function E(){if(!M("comment.delete"))return!1;const t={commentIds:m.value},{valid:e,errors:s}=await I(ue,t);if(!e)return d({message:s[0],type:"error"});const{code:p,ErrorMessage:n}=await W(t);p==200?(d({message:"删除成功",type:"success"}),f()):d({message:n||"删除失败",type:"error"})}const c=_(!1);function S(t){c.value=!0,m.value=[t]}function w(t){c.value=!1,R(t)}const B=J();async function R(t){if(!M("comment.review"))return!1;const e={commentIds:m.value,status:t},{valid:s,errors:p}=await I(ce,e);if(!s)return d({message:p[0],type:"error"});const{code:n,ErrorMessage:C}=await ne(e);n==200?(d({message:"审核完成",type:"success"}),f(),B.getNoReviewCommentCount()):d({message:C||"审核失败",type:"error"})}async function f(){try{const{code:t,ErrorMessage:e,data:s}=await O({page:i.page,limit:i.limit,status:y.value});if(t==200){const p=new Map;x.value=s.data.map((n,C,r)=>{if(n.createdDateTime=z(n.createdDateTime).format("YYYY-MM-DD HH:mm:ss"),n.updatedDateTime=z(n.updatedDateTime).format("YYYY-MM-DD HH:mm:ss"),n.parentUserId&&n.parentId){if(!p.has(n.parentId)){const g=r.find(k=>k.commentId===n.parentId);g&&(n.parentComent=g.content,p.set(n.parentId,g.content))}n.parentComent=p.get(n.parentId)||""}return n}),i.total=s.totalRecords}else d({message:e||"获取评论失败",type:"warning"})}catch(t){console.log(t),d({message:"获取评论出错",type:"error"})}}const y=_(["pending","approved","rejected"]),U=["pending","approved","rejected"];return K(()=>{f()}),(t,e)=>{const s=Q,p=de,n=pe,C=te,r=re,g=oe,k=me,A=ie,P=le,q=ae;return h(),D("div",fe,[b("div",ge,[o(s,{type:"primary",disabled:m.value.length==0,onClick:e[0]||(e[0]=()=>c.value=!0)},{default:l(()=>e[9]||(e[9]=[u("批量审核")])),_:1},8,["disabled"]),o(s,{type:"success",disabled:m.value.length==0,onClick:E},{default:l(()=>e[10]||(e[10]=[u("批量删除")])),_:1},8,["disabled"]),b("div",ve,[o(C,{class:"box-item",effect:"dark",content:"网络获取什么状态下的评论",placement:"top-start"},{default:l(()=>[o(n,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),size:"default",onChange:f},{default:l(()=>[(h(),D(X,null,Z(U,a=>o(p,{key:a,value:a},{default:l(()=>[u(ee(a=="pending"?"尚未审核":a=="approved"?"审核通过":"审核不通过"),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])]),_:1})])]),o(A,{stripe:"","row-class-name":T,data:x.value,style:{width:"100%"},onSelectionChange:H},{default:l(()=>[o(r,{"header-align":"center",type:"selection",align:"center",label:"是否勾选"}),o(r,{type:"index",prop:"prop",label:"序号",width:"80"}),o(r,{prop:"userName",label:"回复方",width:"80"}),o(r,{prop:"parentUserName",label:"被回复方",width:"80"}),o(r,{prop:"parentComent","show-overflow-tooltip":"",label:"被回复方评论",width:"180"}),o(r,{prop:"content",label:"回复内容",width:"180","show-overflow-tooltip":""}),o(r,{prop:"articleTitle",label:"文章","show-overflow-tooltip":"",width:"180"}),o(r,{prop:"createdDateTime",label:"创建时间"}),o(r,{prop:"updatedDateTime",label:"修改时间"}),o(r,{prop:"status",label:"审核状态",filters:[{text:"待审核",value:"pending"},{text:"审核通过",value:"approved"},{text:"审核不通过",value:"rejected"}],formatter:V,"filter-method":Y}),o(r,{label:"操作"},{default:l(({row:a,$index:we})=>[o(k,{title:"确认要删除吗?",onConfirm:F=>N(a.commentId)},{reference:l(()=>[o(g,{type:"danger",icon:"Delete",size:"default",title:"删除"})]),_:2},1032,["onConfirm"]),o(g,{type:"success",icon:"CircleCheck",onClick:F=>S(a.commentId),size:"default",title:"审核"},null,8,["onClick"])]),_:1})]),_:1},8,["data"]),o(P,{"current-page":v(i).page,"onUpdate:currentPage":e[2]||(e[2]=a=>v(i).page=a),"page-size":v(i).limit,"onUpdate:pageSize":e[3]||(e[3]=a=>v(i).limit=a),background:"","page-sizes":v(i).limits,layout:"total, sizes, prev, pager, next, jumper",total:v(i).total,onCurrentChange:j,onSizeChange:$},null,8,["current-page","page-size","page-sizes","total"]),o(q,{modelValue:c.value,"onUpdate:modelValue":e[8]||(e[8]=a=>c.value=a),title:"审核选择提醒",width:"500",center:""},{footer:l(()=>[b("div",Ce,[o(s,{onClick:e[4]||(e[4]=a=>c.value=!1)},{default:l(()=>e[11]||(e[11]=[u("取消")])),_:1}),o(s,{type:"info",onClick:e[5]||(e[5]=a=>w("pending"))},{default:l(()=>e[12]||(e[12]=[u(" 待审核 ")])),_:1}),o(s,{type:"danger",onClick:e[6]||(e[6]=a=>w("rejected"))},{default:l(()=>e[13]||(e[13]=[u(" 审核不通过 ")])),_:1}),o(s,{type:"success",onClick:e[7]||(e[7]=a=>w("approved"))},{default:l(()=>e[14]||(e[14]=[u(" 审核通过 ")])),_:1})])]),default:l(()=>[e[15]||(e[15]=b("span",null," 请选择一个审核的状态 ",-1))]),_:1},8,["modelValue"])])}}}),Ve=se(_e,[["__scopeId","data-v-16c5dec9"]]);export{Ve as default};
